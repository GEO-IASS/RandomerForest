t = readtable('/cis/home/ttomita/Data/data_idx.txt','ReadVariableNames',false,'ReadRowNames',false);
dirnames = t.Var1;
Results = struct('Lhat',struct,'Time',struct);
j = 1;
for i = 1:length(dirnames)
    dirname = dirnames{i};
    try
        load(strcat('/cis/home/ttomita/Data/',dirname,'/',dirname,'.mat'),'Lhat','Time')
        Results.Lhat.(strrep(dirname,'-','__')) = Lhat;
        Results.Time.(strrep(dirname,'-','__')) = Time;
    catch
        warning(sprintf('%s workspace file does not exist',dirname))
        rmidx(j) = i;
	j = j + 1;
    end
end

dirnames(rmidx) = [];

for i = 1:length(dirnames)
    dirname = dirnames{i};
    clnames = fieldnames(Results.Lhat.(strrep(dirname,'-','__')));
    for j = 1:length(clnames)
        clname = clnames{j};
        Lhat_all.(clname)(i,:) = Results.Lhat.(strrep(dirname,'-','__')).(clname);
        Time_all.(clname)(i,:) = Results.Time.(strrep(dirname,'-','__')).(clname);
    end
end

lspec = {'bs','rs','gs' 'cs' 'ms' 'ks'};
facespec = {'b','r','g' 'c' 'm' 'k'};

for i = 1:length(clnames)
    clname = clnames{i};
    Lhat_mean.(clname) = mean(Lhat_all.(clname));
    Lhat_sem.(clname) = std(Lhat_all.(clname))/sqrt(length(dirnames));
    Time_mean.(clname) = mean(Time_all.(clname));
    Time_sem.(clname) = std(Time_all.(clname))/sqrt(length(dirnames));
    errorbar(Time_mean.(clname)(end),Lhat_mean.(clname)(end),Lhat_sem.(clname)(end),lspec{i},'MarkerEdgeColor','k','MarkerFaceColor',facespec{i});
    hold on
end

xlabel('Training Time (sec)')
ylabel('Lhat')
legend('Random Forest','Dense Gaussian Randomer Forest','Sparse Randomer Forest','Sparse Randomer Forest w/ Mean Diff','Robust Sparse Randomer Forest w/ Mean Diff')

save('/cis/home/ttomita/Data/Fig4_Summary.mat','Results','Lhat_mean','Lhat_sem','Time_mean','Time_sem')
save_fig(gcf,'/cis/home/ttomita/Data/Fig4_Real_Data')
